#!/bin/sh

# Locate relevant directories.
THIS_SCRIPT=$(basename "$0" .sh)
SCRIPT_DIR=$(dirname "$0") && [ "$SCRIPT_DIR" = "." ] && SCRIPT_DIR=$(pwd)
PARENT_DIR=$(dirname "$SCRIPT_DIR")
LIB_DIR="$PARENT_DIR"/lib
RESOURCES_DIR="$PARENT_DIR"/resources
CLASSES_DIR="$PARENT_DIR"/classes
MAIN_CLASS=com.alteredmechanism.notepad.Notepad

OS=$(uname -s)

# Set the icon for Mac.
if [ "$OS" = 'Darwin' ]
then
	MAC_ICON_SWITCH=-Xdock:icon="$RESOURCES_DIR"/icons/notepad-64x64.png
else
	unset MAC_ICON_SWITCH
fi

# Build CLAZZPATH
CLAZZPATH="$CLASSES_DIR:$RESOURCES_DIR"

# Run
if [ -z "$MAC_ICON_SWITCH" ]
then
    MSG=$(java -cp "$CLAZZPATH" "$MAIN_CLASS" "$@" 2>&1)
else
    MSG=$(java "$MAC_ICON_SWITCH" -cp "$CLAZZPATH" "$MAIN_CLASS" "$@" 2>&1)
fi

if [ -n "$MSG" ]
then
    # The "which" command does not return 1 on failure in OSX 10.4.11.
    if type zenity > /dev/null
    then
        zenity --error --text="$THIS_SCRIPT: $MSG"
    elif type xmessage > /dev/null
    then
        xmessage -center "$THIS_SCRIPT: $MSG"
    elif type xterm > /dev/null
    then
        xterm -title "$0" \
            -e "echo $MSG; echo Press Enter to continue.; read LINE"
    else
        echo "$THIS_SCRIPT: $MSG" 1>&2
    fi
fi

